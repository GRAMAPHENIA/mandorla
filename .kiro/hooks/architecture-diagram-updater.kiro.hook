{
  "enabled": true,
  "name": "Actualizador de Diagramas de Arquitectura",
  "description": "Hook que actualiza automÃ¡ticamente los diagramas de arquitectura cuando se modifican mÃ³dulos, servicios o componentes, manteniendo la documentaciÃ³n visual sincronizada",
  "version": "1",
  "when": {
    "type": "fileEdited",
    "patterns": [
      "src/modules/**/domain/**/*.ts",
      "src/modules/**/application/**/*.ts",
      "src/modules/**/infrastructure/**/*.ts",
      "src/modules/**/presentation/**/*.tsx",
      "src/app/api/**/*.ts"
    ]
  },
  "then": {
    "type": "askAgent",
    "prompt": "Actualiza automÃ¡ticamente los diagramas de arquitectura basÃ¡ndose en los cambios realizados en el mÃ³dulo o componente:\n\n## 1. AnÃ¡lisis de Cambios ArquitectÃ³nicos\n\n**Detectar modificaciones en:**\n- Nuevas entidades de dominio\n- Servicios de aplicaciÃ³n agregados/modificados\n- Repositorios e interfaces de infraestructura\n- Componentes de presentaciÃ³n\n- APIs y endpoints\n- Dependencias entre mÃ³dulos\n\n**Identificar impacto:**\n- Cambios en flujos de datos\n- Nuevas relaciones entre mÃ³dulos\n- Modificaciones en patrones de arquitectura\n- Actualizaciones en interfaces pÃºblicas\n\n## 2. Diagramas a Actualizar\n\n### Diagrama de Arquitectura General\n```mermaid\ngraph TB\n    subgraph \"Capa de PresentaciÃ³n\"\n        UI[Componentes UI]\n        Pages[PÃ¡ginas Next.js]\n        Layouts[Layouts]\n    end\n    \n    subgraph \"Capa de AplicaciÃ³n\"\n        Products[MÃ³dulo Productos]\n        Cart[MÃ³dulo Carrito]\n        Orders[MÃ³dulo Pedidos]\n        Customers[MÃ³dulo Clientes]\n    end\n    \n    subgraph \"Capa de Infraestructura\"\n        API[API Routes]\n        Storage[Almacenamiento]\n        External[APIs Externas]\n    end\n    \n    UI --> Products\n    UI --> Cart\n    Products --> API\n    Cart --> Storage\n```\n\n### Diagrama de MÃ³dulo EspecÃ­fico (Arquitectura Hexagonal)\n```mermaid\ngraph LR\n    subgraph \"[NombreModulo]\"\n        subgraph \"Domain\"\n            E[Entidades]\n            VO[Value Objects]\n            DE[Domain Events]\n        end\n        \n        subgraph \"Application\"\n            UC[Use Cases]\n            S[Services]\n            I[Interfaces]\n        end\n        \n        subgraph \"Infrastructure\"\n            R[Repositories]\n            A[Adapters]\n            API[API Clients]\n        end\n        \n        subgraph \"Presentation\"\n            C[Components]\n            H[Hooks]\n            P[Pages]\n        end\n    end\n    \n    UC --> E\n    S --> VO\n    R --> I\n    C --> UC\n```\n\n### Diagrama de Flujo de Datos\n```mermaid\nsequenceDiagram\n    participant U as Usuario\n    participant C as Componente\n    participant S as Servicio\n    participant R as Repositorio\n    participant DB as Base de Datos\n    \n    U->>C: AcciÃ³n del usuario\n    C->>S: Llamada al servicio\n    S->>R: Consulta datos\n    R->>DB: Query\n    DB-->>R: Resultado\n    R-->>S: Datos\n    S-->>C: Respuesta\n    C-->>U: UI actualizada\n```\n\n### Diagrama de Dependencias entre MÃ³dulos\n```mermaid\ngraph TD\n    Shared[MÃ³dulo Compartido]\n    Products[MÃ³dulo Productos]\n    Cart[MÃ³dulo Carrito]\n    Orders[MÃ³dulo Pedidos]\n    Customers[MÃ³dulo Clientes]\n    \n    Products --> Shared\n    Cart --> Shared\n    Cart --> Products\n    Orders --> Shared\n    Orders --> Products\n    Orders --> Cart\n    Orders --> Customers\n    Customers --> Shared\n```\n\n## 3. Tipos de Diagramas por Contexto\n\n### Para Entidades de Dominio\n```mermaid\nclassDiagram\n    class ProductEntity {\n        -id: ProductId\n        -name: string\n        -price: Money\n        -category: ProductCategory\n        +updatePrice(newPrice: Money)\n        +changeAvailability(available: boolean)\n    }\n    \n    class Money {\n        -value: number\n        -currency: string\n        +add(other: Money): Money\n        +multiply(factor: number): Money\n    }\n    \n    ProductEntity --> Money\n```\n\n### Para Servicios de AplicaciÃ³n\n```mermaid\ngraph LR\n    subgraph \"Servicios de AplicaciÃ³n\"\n        PS[ProductService]\n        CS[CartService]\n        OS[OrderService]\n    end\n    \n    subgraph \"Repositorios\"\n        PR[ProductRepository]\n        CR[CartRepository]\n        OR[OrderRepository]\n    end\n    \n    PS --> PR\n    CS --> CR\n    CS --> PR\n    OS --> OR\n    OS --> CR\n    OS --> PR\n```\n\n### Para APIs y Endpoints\n```mermaid\ngraph TB\n    Client[Cliente]\n    \n    subgraph \"API Routes\"\n        ProductsAPI[\"/api/products\"]\n        CartAPI[\"/api/cart\"]\n        OrdersAPI[\"/api/orders\"]\n    end\n    \n    subgraph \"Servicios\"\n        ProductService\n        CartService\n        OrderService\n    end\n    \n    Client --> ProductsAPI\n    Client --> CartAPI\n    Client --> OrdersAPI\n    \n    ProductsAPI --> ProductService\n    CartAPI --> CartService\n    OrdersAPI --> OrderService\n```\n\n## 4. GeneraciÃ³n AutomÃ¡tica de Diagramas\n\n### AnÃ¡lisis de CÃ³digo\n**Extraer informaciÃ³n de:**\n- Imports y exports de mÃ³dulos\n- Definiciones de clases e interfaces\n- Relaciones entre entidades\n- Flujos de llamadas entre servicios\n- Estructura de carpetas y archivos\n\n### DetecciÃ³n de Patrones\n**Identificar:**\n- PatrÃ³n Repository implementado\n- InyecciÃ³n de dependencias\n- Eventos de dominio\n- Casos de uso definidos\n- Adaptadores de infraestructura\n\n### GeneraciÃ³n de CÃ³digo Mermaid\n**Crear diagramas:**\n- Diagramas de clases para entidades\n- Diagramas de flujo para casos de uso\n- Diagramas de secuencia para APIs\n- Diagramas de componentes para UI\n\n## 5. Estructura de Archivos de Diagramas\n\n### OrganizaciÃ³n\n```\ndocs/\nâ”œâ”€â”€ architecture/\nâ”‚   â”œâ”€â”€ overview.md              # Diagrama general\nâ”‚   â”œâ”€â”€ modules/\nâ”‚   â”‚   â”œâ”€â”€ productos.md         # Diagrama mÃ³dulo productos\nâ”‚   â”‚   â”œâ”€â”€ carrito.md          # Diagrama mÃ³dulo carrito\nâ”‚   â”‚   â””â”€â”€ pedidos.md          # Diagrama mÃ³dulo pedidos\nâ”‚   â”œâ”€â”€ flows/\nâ”‚   â”‚   â”œâ”€â”€ checkout-flow.md     # Flujo de checkout\nâ”‚   â”‚   â””â”€â”€ product-search.md    # Flujo de bÃºsqueda\nâ”‚   â””â”€â”€ apis/\nâ”‚       â”œâ”€â”€ products-api.md      # Diagrama API productos\nâ”‚       â””â”€â”€ cart-api.md         # Diagrama API carrito\n```\n\n### Formato de Archivo\n```markdown\n# Diagrama: [TÃ­tulo]\n\n## DescripciÃ³n\n[ExplicaciÃ³n del diagrama y su propÃ³sito]\n\n## Diagrama\n```mermaid\n[CÃ³digo del diagrama]\n```\n\n## Componentes\n- **[Componente 1]**: [DescripciÃ³n]\n- **[Componente 2]**: [DescripciÃ³n]\n\n## Flujos Principales\n1. [DescripciÃ³n del flujo 1]\n2. [DescripciÃ³n del flujo 2]\n\n## Notas de ImplementaciÃ³n\n- [Detalles tÃ©cnicos importantes]\n- [Patrones utilizados]\n- [Consideraciones de diseÃ±o]\n\n## Ãšltima ActualizaciÃ³n\n- **Fecha**: [fecha]\n- **Cambios**: [descripciÃ³n de cambios]\n```\n\n## 6. Validaciones y Consistencia\n\n### Verificar Coherencia\n- Los diagramas reflejan el cÃ³digo actual\n- Las relaciones entre mÃ³dulos son correctas\n- Los flujos de datos son precisos\n- La nomenclatura es consistente\n\n### Detectar Inconsistencias\n- Dependencias circulares\n- MÃ³dulos huÃ©rfanos\n- Interfaces no implementadas\n- Servicios no utilizados\n\n## 7. IntegraciÃ³n con DocumentaciÃ³n\n\n### Enlaces AutomÃ¡ticos\n- Conectar diagramas con documentaciÃ³n de componentes\n- Referenciar APIs desde diagramas de flujo\n- Vincular entidades con sus casos de uso\n\n### Ãndices Actualizados\n- Actualizar tabla de contenidos\n- Generar Ã­ndice de diagramas\n- Crear enlaces cruzados\n\n## Instrucciones de EjecuciÃ³n\n\n1. **Analizar** el archivo modificado y su contexto\n2. **Identificar** quÃ© diagramas necesitan actualizaciÃ³n\n3. **Extraer** informaciÃ³n arquitectÃ³nica relevante\n4. **Generar** cÃ³digo Mermaid actualizado\n5. **Validar** coherencia con otros diagramas\n6. **Actualizar** archivos de documentaciÃ³n\n7. **Crear** enlaces y referencias cruzadas\n\n**Formato de Respuesta:**\n- ğŸ“Š **Diagramas actualizados**: [lista de diagramas modificados]\n- ğŸ”„ **Cambios detectados**: [descripciÃ³n de cambios arquitectÃ³nicos]\n- ğŸ”— **Relaciones nuevas**: [nuevas dependencias o conexiones]\n- âš ï¸ **Inconsistencias**: [problemas detectados en la arquitectura]\n- ğŸ“ **Archivos generados**: [archivos de documentaciÃ³n creados/actualizados]\n- ğŸ’¡ **Sugerencias**: [mejoras arquitectÃ³nicas recomendadas]"
  }
}