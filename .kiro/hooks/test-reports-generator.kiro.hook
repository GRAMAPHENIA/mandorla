{
  "enabled": true,
  "name": "Generador de Reportes de Testing",
  "description": "Hook que genera reportes automÃ¡ticos de resultados de testing, mÃ©tricas de calidad y tendencias, proporcionando visibilidad completa del estado de las pruebas",
  "version": "1",
  "when": {
    "type": "fileEdited",
    "patterns": [
      "**/*.test.{ts,tsx,js}",
      "**/*.spec.{ts,tsx,js}",
      "**/__tests__/**/*.{ts,tsx,js}"
    ]
  },
  "then": {
    "type": "askAgent",
    "prompt": "Genera reportes automÃ¡ticos de testing cuando se modifican o crean tests, proporcionando mÃ©tricas y anÃ¡lisis de calidad:\n\n## 1. AnÃ¡lisis de Tests Modificados\n\n### DetecciÃ³n de Cambios en Tests\n**Identificar**:\n- Tests nuevos agregados\n- Tests modificados o actualizados\n- Tests eliminados\n- Cambios en configuraciÃ³n de testing\n- Nuevos archivos de test creados\n\n### ClasificaciÃ³n de Tests\n**Por tipo**:\n- **Unitarios**: `*.test.ts`, `*.spec.ts`\n- **IntegraciÃ³n**: `*.integration.test.ts`\n- **End-to-End**: `*.e2e.test.ts`\n- **Componentes**: `*.component.test.tsx`\n\n**Por mÃ³dulo**:\n- **Dominio**: `src/modules/*/domain/**/*.test.ts`\n- **AplicaciÃ³n**: `src/modules/*/application/**/*.test.ts`\n- **Infraestructura**: `src/modules/*/infrastructure/**/*.test.ts`\n- **PresentaciÃ³n**: `src/modules/*/presentation/**/*.test.tsx`\n\n## 2. MÃ©tricas de Calidad de Tests\n\n### MÃ©tricas BÃ¡sicas\n```typescript\ninterface TestMetrics {\n  totalTests: number\n  passedTests: number\n  failedTests: number\n  skippedTests: number\n  executionTime: number\n  coverage: {\n    lines: number\n    branches: number\n    functions: number\n    statements: number\n  }\n}\n```\n\n### MÃ©tricas Avanzadas\n```typescript\ninterface AdvancedTestMetrics {\n  testComplexity: {\n    averageAssertions: number\n    averageTestLength: number\n    complexTests: string[] // Tests con muchas lÃ­neas\n  }\n  testMaintainability: {\n    duplicatedCode: number\n    testSmells: string[] // Anti-patrones detectados\n    outdatedMocks: string[]\n  }\n  testEffectiveness: {\n    mutationScore: number // Si se usa mutation testing\n    flakyTests: string[] // Tests que fallan intermitentemente\n    slowTests: string[] // Tests que tardan mucho\n  }\n}\n```\n\n## 3. GeneraciÃ³n de Reportes por CategorÃ­a\n\n### Reporte de Tests Unitarios\n```markdown\n# ğŸ§ª Reporte de Tests Unitarios\n\n## Resumen Ejecutivo\n- **Total de tests**: [nÃºmero]\n- **Tests exitosos**: [nÃºmero] ([porcentaje]%)\n- **Tests fallidos**: [nÃºmero] ([porcentaje]%)\n- **Cobertura promedio**: [porcentaje]%\n- **Tiempo de ejecuciÃ³n**: [tiempo]\n\n## Detalles por MÃ³dulo\n\n### MÃ³dulo de Productos\n- **Archivos de test**: 12\n- **Tests**: 45 (âœ… 42, âŒ 3)\n- **Cobertura**: 87% (lÃ­neas), 82% (ramas)\n- **Tiempo**: 2.3s\n- **Estado**: âš ï¸ 3 tests fallando\n\n#### Tests Fallidos\n1. `product-entity.test.ts:45` - \"deberÃ­a calcular descuento correctamente\"\n   - **Error**: Expected 2250, received 2500\n   - **Causa**: Cambio en lÃ³gica de descuentos\n   - **AcciÃ³n**: Actualizar test o revisar lÃ³gica\n\n### MÃ³dulo de Carrito\n- **Archivos de test**: 8\n- **Tests**: 32 (âœ… 32, âŒ 0)\n- **Cobertura**: 92% (lÃ­neas), 88% (ramas)\n- **Tiempo**: 1.8s\n- **Estado**: âœ… Todos los tests pasan\n\n## Tendencias (Ãšltimos 7 dÃ­as)\n- **Cobertura**: 85% â†’ 87% (+2%)\n- **Tests totales**: 156 â†’ 162 (+6)\n- **Tiempo promedio**: 8.2s â†’ 7.9s (-0.3s)\n- **Tests fallidos**: 2 â†’ 3 (+1)\n\n## Recomendaciones\n1. Revisar tests fallidos en mÃ³dulo de productos\n2. Agregar tests para nuevas funcionalidades\n3. Optimizar tests lentos (>5s)\n4. Mejorar cobertura en mÃ³dulo de pedidos (72%)\n```\n\n### Reporte de Tests de IntegraciÃ³n\n```markdown\n# ğŸ”— Reporte de Tests de IntegraciÃ³n\n\n## Resumen Ejecutivo\n- **Flujos probados**: [nÃºmero]\n- **APIs cubiertas**: [nÃºmero]/[total]\n- **Tiempo total**: [tiempo]\n- **Estado general**: [âœ…/âŒ/âš ï¸]\n\n## Flujos CrÃ­ticos\n\n### âœ… Flujo de Checkout\n- **Tests**: 8/8 pasando\n- **Cobertura**: Completa (carrito â†’ pedido â†’ pago)\n- **Tiempo**: 15.2s\n- **Ãšltima ejecuciÃ³n**: Exitosa\n\n### âŒ Flujo de BÃºsqueda\n- **Tests**: 5/7 pasando\n- **Problemas**: Filtros avanzados fallan\n- **Tiempo**: 12.1s\n- **AcciÃ³n requerida**: Revisar lÃ³gica de filtros\n\n### âš ï¸ Flujo de Registro\n- **Tests**: 6/6 pasando\n- **Advertencia**: Lento (>20s)\n- **Causa**: ValidaciÃ³n de email externa\n- **Sugerencia**: Optimizar o mockear servicio\n\n## APIs Probadas\n\n| Endpoint | Tests | Estado | Cobertura | Tiempo |\n|----------|-------|--------|-----------|--------|\n| /api/products | 12 | âœ… | 95% | 3.2s |\n| /api/cart | 8 | âœ… | 100% | 2.1s |\n| /api/orders | 6 | âŒ | 80% | 4.5s |\n| /api/customers | 4 | âœ… | 90% | 1.8s |\n\n## Dependencias Externas\n- **Base de datos**: âœ… ConexiÃ³n estable\n- **Servicio de email**: âš ï¸ Timeout ocasional\n- **API de pagos**: âœ… Mock funcionando\n- **Servicio de inventario**: âœ… Respuestas rÃ¡pidas\n```\n\n### Reporte de Cobertura Detallado\n```markdown\n# ğŸ“Š Reporte de Cobertura de CÃ³digo\n\n## Cobertura Global\n- **LÃ­neas**: 1,247/1,456 (85.6%)\n- **Ramas**: 234/278 (84.2%)\n- **Funciones**: 156/178 (87.6%)\n- **Statements**: 1,198/1,398 (85.7%)\n\n## Cobertura por MÃ³dulo\n\n### ğŸŸ¢ MÃ³dulos con Buena Cobertura (>80%)\n| MÃ³dulo | LÃ­neas | Ramas | Funciones | Statements |\n|--------|--------|-------|-----------|------------|\n| Carrito | 92% | 88% | 95% | 91% |\n| Productos | 87% | 82% | 89% | 86% |\n| Clientes | 85% | 80% | 87% | 84% |\n\n### ğŸŸ¡ MÃ³dulos que Necesitan Mejora (60-80%)\n| MÃ³dulo | LÃ­neas | Ramas | Funciones | Statements | AcciÃ³n |\n|--------|--------|-------|-----------|------------|--------|\n| Pedidos | 72% | 68% | 75% | 71% | +8 tests |\n| Utilidades | 65% | 60% | 70% | 64% | +5 tests |\n\n### ğŸ”´ MÃ³dulos CrÃ­ticos (<60%)\n| MÃ³dulo | LÃ­neas | Ramas | Funciones | Statements | Prioridad |\n|--------|--------|-------|-----------|------------|----------|\n| Reportes | 45% | 40% | 50% | 44% | Alta |\n\n## Archivos Sin Cobertura\n1. `src/utils/legacy-helpers.ts` - 0% cobertura\n2. `src/lib/deprecated-functions.ts` - 15% cobertura\n3. `src/modules/reportes/domain/entities/report-entity.ts` - 30% cobertura\n\n## LÃ­neas CrÃ­ticas Sin Cobertura\n- **Validaciones de seguridad**: 12 lÃ­neas\n- **Manejo de errores**: 8 lÃ­neas\n- **CÃ¡lculos de negocio**: 15 lÃ­neas\n- **Integraciones externas**: 6 lÃ­neas\n```\n\n## 4. AnÃ¡lisis de Tendencias\n\n### Dashboard de MÃ©tricas HistÃ³ricas\n```json\n{\n  \"testTrends\": {\n    \"last30Days\": [\n      {\n        \"date\": \"2024-01-15\",\n        \"totalTests\": 162,\n        \"passRate\": 98.1,\n        \"coverage\": 87.2,\n        \"executionTime\": 7.9\n      },\n      {\n        \"date\": \"2024-01-14\",\n        \"totalTests\": 158,\n        \"passRate\": 97.5,\n        \"coverage\": 86.8,\n        \"executionTime\": 8.2\n      }\n    ]\n  },\n  \"qualityMetrics\": {\n    \"testComplexity\": {\n      \"trend\": \"improving\",\n      \"averageAssertions\": 3.2,\n      \"complexTestsCount\": 5\n    },\n    \"maintainability\": {\n      \"duplicatedCode\": 2.1,\n      \"testSmells\": 3,\n      \"outdatedMocks\": 1\n    }\n  }\n}\n```\n\n### AnÃ¡lisis de Regresiones\n```markdown\n## ğŸ“ˆ AnÃ¡lisis de Tendencias (30 dÃ­as)\n\n### MÃ©tricas Positivas\n- **Cobertura**: +2.4% (84.8% â†’ 87.2%)\n- **Tests totales**: +12 tests nuevos\n- **Tiempo de ejecuciÃ³n**: -0.8s (optimizaciÃ³n)\n- **Tests de integraciÃ³n**: +3 flujos nuevos\n\n### MÃ©tricas que Requieren AtenciÃ³n\n- **Tests fallidos**: +1 (tendencia al alza)\n- **Tests lentos**: 3 tests >10s (sin cambio)\n- **Mocks desactualizados**: 2 detectados\n\n### Predicciones\n- **Cobertura objetivo 90%**: Alcanzable en 2 semanas\n- **Tiempo de ejecuciÃ³n**: Estable con optimizaciones\n- **Calidad de tests**: Mejorando gradualmente\n```\n\n## 5. DetecciÃ³n de Problemas de Calidad\n\n### Test Smells (Anti-patrones)\n```typescript\n// Detectar problemas comunes en tests\nconst testSmells = {\n  // Tests muy largos (>50 lÃ­neas)\n  longTests: [\n    'src/modules/productos/domain/entities/product-entity.test.ts:125-180'\n  ],\n  \n  // Tests con muchas aserciones (>10)\n  assertionRoulette: [\n    'src/modules/carrito/application/services/cart-service.test.ts:45'\n  ],\n  \n  // Tests que dependen de otros tests\n  testDependency: [\n    'src/modules/pedidos/integration/order-flow.test.ts:67'\n  ],\n  \n  // Mocks complejos o desactualizados\n  complexMocks: [\n    'src/modules/clientes/infrastructure/customer-repository.test.ts:23'\n  ],\n  \n  // Tests duplicados o muy similares\n  duplicatedTests: [\n    'src/components/products/product-card.test.tsx:34',\n    'src/components/products/product-card.test.tsx:67'\n  ]\n}\n```\n\n### Recomendaciones de Mejora\n```markdown\n## ğŸ’¡ Recomendaciones de Mejora\n\n### Inmediatas (Esta semana)\n1. **Corregir tests fallidos** (3 tests en mÃ³dulo productos)\n2. **Actualizar mocks desactualizados** (2 archivos)\n3. **Optimizar tests lentos** (>10s)\n\n### Corto plazo (2 semanas)\n1. **Mejorar cobertura en mÃ³dulo pedidos** (72% â†’ 85%)\n2. **Refactorizar tests complejos** (5 tests identificados)\n3. **Agregar tests de regresiÃ³n** para bugs recientes\n\n### Largo plazo (1 mes)\n1. **Implementar mutation testing** para validar calidad\n2. **Automatizar detecciÃ³n de flaky tests**\n3. **Crear suite de tests de performance**\n```\n\n## 6. IntegraciÃ³n con Herramientas\n\n### ConfiguraciÃ³n de Reportes\n```javascript\n// jest.config.js - ConfiguraciÃ³n de reportes\nmodule.exports = {\n  reporters: [\n    'default',\n    ['jest-html-reporters', {\n      publicPath: './test-reports',\n      filename: 'test-report.html',\n      expand: true\n    }],\n    ['jest-junit', {\n      outputDirectory: './test-reports',\n      outputName: 'junit.xml'\n    }]\n  ],\n  collectCoverage: true,\n  coverageReporters: ['text', 'lcov', 'html', 'json-summary']\n}\n```\n\n### ExportaciÃ³n de Datos\n```typescript\n// Exportar mÃ©tricas para dashboards externos\ninterface TestReportExport {\n  timestamp: string\n  summary: TestSummary\n  coverage: CoverageReport\n  trends: TrendAnalysis\n  recommendations: Recommendation[]\n  exportFormat: 'json' | 'xml' | 'csv'\n}\n```\n\n## 7. Alertas y Notificaciones\n\n### Criterios de Alerta\n- **ğŸ”´ CrÃ­tico**: >5% tests fallando o cobertura <70%\n- **ğŸŸ¡ Advertencia**: DegradaciÃ³n en mÃ©tricas >3%\n- **ğŸŸ¢ InformaciÃ³n**: Mejoras significativas detectadas\n\n### Canales de NotificaciÃ³n\n- **Slack**: Alertas crÃ­ticas y resÃºmenes diarios\n- **Email**: Reportes semanales detallados\n- **Dashboard**: MÃ©tricas en tiempo real\n- **PR Comments**: Comentarios automÃ¡ticos en pull requests\n\n## Instrucciones de EjecuciÃ³n\n\n1. **Detectar** cambios en archivos de test\n2. **Ejecutar** anÃ¡lisis de mÃ©tricas de calidad\n3. **Generar** reportes por categorÃ­a (unitarios, integraciÃ³n, cobertura)\n4. **Analizar** tendencias y detectar regresiones\n5. **Identificar** problemas de calidad y anti-patrones\n6. **Crear** recomendaciones especÃ­ficas\n7. **Exportar** datos para herramientas externas\n\n**Formato de Respuesta:**\n- ğŸ“Š **Reporte generado**: [tipo de reporte]\n- ğŸ§ª **Tests analizados**: [nÃºmero total]\n- ğŸ“ˆ **MÃ©tricas clave**: [cobertura, tiempo, Ã©xito]\n- ğŸ” **Problemas detectados**: [nÃºmero y tipos]\n- ğŸ“‹ **Recomendaciones**: [nÃºmero de acciones sugeridas]\n- ğŸ“ **Archivos generados**: [lista de reportes creados]\n- ğŸš¨ **Alertas**: [nivel de criticidad]\n- ğŸ’¡ **PrÃ³ximos pasos**: [acciones prioritarias]"
  }
}